 

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

    

        /* .dropdown-js-button {
            background-color: transparent;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
        } */

    </style>
    <title>Multi-Level Dropdown</title>
</head>
<body>
    <div style="position:absolute;left:0;top:0">
    <button id="dropdownelement0"  >Dropdown</button>
    </div>
    <div style="position:absolute;right:0;top:0">
        <button id="dropdownelement1" >Dropdown</button>
        </div>
    <div style="position:absolute;left:0;bottom:0">
            <button id="dropdownelement2" >Dropdown</button>
        </div>
        <div style="position:absolute;right:0;bottom:0">
            <button id="dropdownelement3" >Dropdown</button>
        </div>
    <script>
        const NAMESPACE = 'MultiLevelDropdown';
       window[NAMESPACE]=  class  {
            constructor(element, options) {
                this.element = element;
                this.options = Object.assign({
                    direction:'auto', // {x:'auto',y:'auto'} // {x:'right',y:'bottom'},
                    model:(item)=>{ return `${item.html}`;},
                    nodeClick:null //()=>{}
                },options);
 

              
              
                this.init();

                // Add the click event listener to the body element
           window.removeEventListener('click', this.windowClickEventHandler,true); 
           window.addEventListener('click', this.windowClickEventHandler,true);
            }
 
            
            init() {
               // Init Direction
                (()=>{
               
               // stablish direction 
               if(this.options.direction=='auto')this.options.direction = {x:'auto',y:'auto'};
   
               if(this.options.direction.x =='auto'|| this.options.direction.y =='auto'){
                   let auto =  (()=>{
                                   
                                   // Get the element's position relative to the viewport
                                   const rect = this.element.getBoundingClientRect();
                   
                                   // Get the viewport dimensions
                                   const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
                                   const viewportHeight = window.innerHeight || document.documentElement.clientHeight;
                   
                                   // Calculate the element's distance from the left and top of the viewport
                                   const distanceLeft = rect.left;
                                   const distanceTop = rect.top;
                   
                                   // Calculate the element's distance from the right and bottom of the viewport
                                   const distanceRight = viewportWidth - rect.right;
                                   const distanceBottom = viewportHeight - rect.bottom;
                   
                                   // Determine if the element is closer to the left or right
                                  return {
                                    
                                   x: distanceLeft < distanceRight ? 'right' : 'left',
                                   y: distanceTop < distanceBottom ? 'bottom' : 'top',
                                   
                                    
                                  };
                    
                               })();
                   this.options.direction.x = (this.options.direction.x=='auto')?auto.x : this.options.direction.x ;
                   this.options.direction.y = (this.options.direction.y=='auto')?auto.y : this.options.direction.y ;
   
   }
               })();
 
                // Create the new ul element
                  this.dropdown = document.createElement('ul');
                this.dropdown.className = 'dropdown-js-menu dropdown-js-dir-'+this.options.direction.x +' dropdown-js-dir-'+this.options.direction.y; 
                this.element.insertAdjacentElement('afterend', this.dropdown);
                this.element.className= "dropdown-js-button "  +(this.element.className||'');

                // initialize
                 const button = this.element;
                const dropdownMenu = this.element.nextElementSibling;
                this.buildSubMenu(this.options.data, dropdownMenu);

                button.addEventListener('click', () => {

                    if(!dropdownMenu.classList.contains('show'))  this.hideLevel(dropdownMenu.parentNode); 
                    dropdownMenu.classList.toggle('show');
                });
            }

            hide(){ 
            this.hideLevel(this.element.parentNode);
            }
 
        
 
            buildSubMenu(data, parentElement) {
           
          
     //console.log(typeof options.data)
                data.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('dropdown-js-item');

                    const listItemLink = document.createElement('a');
                    listItemLink.classList.add('dropdown-js-item-link'); 
                    listItemLink.innerHTML = this.options.model(item);

                    listItem.appendChild(listItemLink);
                    
                    parentElement.appendChild(listItem);

                    if (item.children && item.children.length > 0) {
                        listItem.classList.add('has-children');
                        const subMenu = document.createElement('ul');
                        subMenu.classList.add('dropdown-js-sub-menu'); 

                    
                        listItem.appendChild(subMenu);
                        this.buildSubMenu(item.children, subMenu);
                        
                        // Toggle submenu on click
                        listItem.addEventListener('click', (e) => {
                            event.stopPropagation();
                             

                       if(!listItem.classList.contains('open')){
                        this.hideLevel(e.target.parentNode);
              
 
                       }  
                  

                        listItem.classList.toggle('open');
                        subMenu.classList.toggle('show');
                        });
                     
                    } else {
                   
                        listItem.addEventListener('click', (e) => {
                        
                        // no children item 
                       
                        this.hideLevel(this.element.parentNode);
                           });


                         listItem.classList.add('no-children');
                    }
                });

                if( this.options.direction.y == 'top') window[NAMESPACE].reverseChildrenOrder(parentElement);

            }
          // Define the click event handler function
           windowClickEventHandler(event) { 
            // check button and menu for click
            let dropdownMenu = window[NAMESPACE].closest(event.target, '.dropdown-js-button') ? 
            window[NAMESPACE].closest(event.target, '.dropdown-js-button').nextElementSibling :
            window[NAMESPACE].closest(event.target, 'ul.dropdown-js-menu');
            // Find all ul.dropdown-js-menu elements
            const dropdownMenus = document.querySelectorAll('ul.dropdown-js-menu');

            // Filter out the ones that are not equal to the given element
            const filteredDropdownMenus = Array.from(dropdownMenus).filter(function(menu) { return menu !== dropdownMenu;  });
            // hide filtered 
            filteredDropdownMenus.forEach(element => {
                element = element.parentNode; 
                window[NAMESPACE].recurseMethod( Array.from(element.querySelectorAll('ul.dropdown-js-menu')).concat(Array.from(element.querySelectorAll('ul.dropdown-js-sub-menu'))),(element)=>{  element.classList.remove('show')});
                window[NAMESPACE].recurseMethod(element.querySelectorAll('li.dropdown-js-item'),(element)=>{  element.classList.remove('open')});
    

           });
            }



        hideLevel(element){
            window[NAMESPACE].recurseMethod( Array.from(element.querySelectorAll('ul.dropdown-js-menu')).concat(Array.from(element.querySelectorAll('ul.dropdown-js-sub-menu'))),(element)=>{  element.classList.remove('show')});
            window[NAMESPACE].recurseMethod(element.querySelectorAll('li.dropdown-js-item'),(element)=>{  element.classList.remove('open')});
    
            }
                    
        static closest(element,selector){
            let currentElement = element;

            while (currentElement) {
                if (currentElement.matches(selector)) {
                return currentElement;
                }
                
                currentElement = currentElement.parentElement;
            }

            // If no matching ancestor is found, return null
            return null;
            }
        static recurseMethod(elements, method) {
            elements.forEach((element) => {
            
                const children = element.children;
                for (const child of children) {
                    method(child);
                }
            
                method(element);
            });
            }
        static reverseChildrenOrder(parentElement) {
            const children = parentElement.children;
            const fragment = document.createDocumentFragment();

            while (children.length > 0) {
                fragment.appendChild(children[children.length - 1]);
            }

            parentElement.appendChild(fragment);
        }
 


        }
 

        const options = {
            data:[ 
                { html: 'a', children: [{ html: 'a.a' }, { html: 'a.b' }] },
                {
                    html: 'b',
                    children: [
                        { html: 'b.a' },
                        { html: 'b.b', children: [{ html: 'b.b.a' }, { html: 'b.b.b' }] },
                    ],
                },
            ]
        }
        
 

     new window[NAMESPACE](document.querySelector('#dropdownelement0'),options);
     new window[NAMESPACE](document.querySelector('#dropdownelement1'),options);
     new window[NAMESPACE](document.querySelector('#dropdownelement2'),options);
     new window[NAMESPACE](document.querySelector('#dropdownelement3'),options);
    </script>
</body>
</html>
